# 📚 개발 도서 스터디 템플릿

## 🧠 1. 책을 읽기 전에
- **기대하는 점**: 실무에서 자주 마주치는 리눅스 시스템 관리 상황들을 효율적으로 해결하는 방법
- **알고 싶은 개념 / 주제**: 운영 서버에서 문제가 생겼을 때 어떤 명령어를 어떤 순서로 사용해야 하는지

---

## 📂 2. 내용 정리 (자신의 언어로 요약)

### 📌 OS 계정과 권한 관리

#### 🔍 **권한 확인과 변경**

리눅스 시스템에서 파일과 디렉토리의 권한을 제대로 관리하는 것은 보안의 기본이다. 
ls -al 명령어를 통해서 현재 권한 상태를 확인할 수 있고, 이를 통해 어떤 사용자가 어떤 권한을 가지고 있는지 파악할 수 있다.

```bash
# 기본 권한 확인
ls -al

# 권한 변경 - 숫자 방식
chmod 755 startup.sh

# 권한 변경 - 기호 방식  
chmod u+x script.sh

# 소유권 변경
chown myapp:myapp application.jar
chown -R myapp:myapp /opt/myapp/
```

chmod를 통해 권한을 변경할 수 있고, chown을 통해 소유권을 변경할 수 있다. 

특히 재귀적으로 디렉토리 전체의 소유권을 변경할 때는 -R 옵션을 사용한다.

#### 🛡️ **실제 서비스 운영 시 계정 관리**

실제 실행되는 서비스의 경우 서비스마다 계정을 만들어서 진행하는 것이 보안상 매우 중요하다. 하나의 계정으로 모든 서비스를 실행하면 하나의 서비스가 compromised 되었을 때 다른 서비스까지 영향을 받을 수 있기 때문이다.

```bash
# 서비스별 계정 생성 예시
sudo useradd -m -s /bin/bash myapp-service
sudo useradd -m -s /bin/bash db-service
```

sudo 권한 편집은 /etc/sudoers에서 관리하며, sudo -l로 현재 계정이 어떤 권한을 가지고 있는지 확인할 수 있다. 

이는 권한 문제로 인한 장애를 미리 방지하는 데 도움이 된다.

#### 🗂️ **파일 삭제 시 주의사항**

rm의 경우 파일 삭제 명령어인데, alias 설정을 통해서 바로 삭제가 아닌 한 번 더 확인하고 삭제하도록 하는 경우가 많다. 

이는 운영 서버에서 실수로 중요한 파일을 삭제하는 것을 방지하기 위한 안전장치다.

```bash
# 안전한 rm alias 설정 예시
alias rm='rm -i'  # 삭제 전 확인
alias rm='trash'  # 휴지통으로 이동
```

---

### 📌 프로세스 종료 방법

#### ⚠️ **올바른 프로세스 종료 순서**

kill -9를 통해 강제 종료할 수 있으나 -15를 통해 graceful shutdown을 유도하는 게 좋다.

갑작스러운 강제 종료는 데이터 손실이나 파일 충돌을 야기할 수 있기 때문이다.

```bash
# 1단계: 정상 종료 신호 (SIGTERM)
kill -15 [PID]

# 2단계: 시간을 두고 기다린 후
sleep 10

# 3단계: 여전히 실행 중이면 강제 종료 (SIGKILL)
kill -9 [PID]
```

SIGTERM(-15)은 프로세스에게 "정리하고 종료하라"는 정중한 요청이고, SIGKILL(-9)은 "지금 당장 멈춰라"는 강제 명령이다.

---

### 📌 디스크 용량 관리

#### 📊 **용량 확인 명령어들**

디스크 용량 관리는 서버 운영에서 가장 기본적이면서도 중요한 작업이다. df -h를 통해서 파일시스템별로 얼마나 용량을 사용하고 있는지 확인할 수 있지만, 실제 파일별 크기를 정확히 알려면 du -h로 파일 크기 확인하는게 더 정확하다.

```bash
# 파일시스템 전체 사용량
df -h

# 특정 디렉토리의 상세 사용량
du -h --max-depth=1 /var/log
du -sh /var/log/*  # 각 파일/디렉토리별 크기
```

du 명령어는 옵션을 통해서 킬로바이트, 메가바이트, 기가바이트 수준으로도 검사가 가능하여 용량 분석에 매우 유용하다.

#### 🗂️ **로그 파일 관리 전략**

find 명령어로 일괄 처리하는 방식도 좋지만 주의가 필요하다. 시작 위치가 어디냐에 따라서 찾는 시간도 오래 걸릴 수도 있고, 더 다양한 조건을 걸어서 처리하고 싶다면 find보다는 log rotation을 이용하는 방법도 있다.

```bash
# find를 사용한 로그 정리 (주의해서 사용)
find /var/log -name "*.log" -mtime +30 -type f -delete

# logrotate 설정 예시
/var/log/myapp/*.log {
    daily
    rotate 30
    compress
    missingok
}
```

아니라면 책에 나온 것처럼 날짜별로 디렉토리 구조로 처리하는 것도 좋은 방법이다. 이렇게 하면 특정 날짜의 로그를 찾기도 쉽고, 관리도 체계적으로 할 수 있다.

#### 🔧 **시스템 제한 관리와 아이노드**

이때 주의할 점으로 최대 파일 크기 생성 및 오픈 수가 제한이 걸려 있는데 이를 충분히 크게 늘려줘야 한다. 특히 대용량 트래픽을 처리하는 서비스에서는 이 제한들이 성능 병목이 될 수 있다.

```bash
# 아이노드 사용량 확인
df -i  # mount한 블록의 아이노드 제한을 볼 수 있음

# 파일 디스크립터 제한 확인 및 변경
ulimit -n  # 현재 제한 확인
ulimit -n 65536  # 제한 늘리기
```

아이노드는 파일시스템에서 파일 하나당 하나씩 할당되는 고유한 식별자다. 아이노드가 부족하면 디스크에 공간이 있어도 새로운 파일을 생성할 수 없다. 시스템 명령어를 통해서 아이노드 크기 제한도 늘릴 수 있지만, 이는 파일시스템을 다시 포맷해야 하는 경우가 많아 운영 중에는 어렵다.

ulimit으로 파일디스크립터 제한을 늘릴 수 있다. 운영에서도 항상 이 부분을 신경쓰고 있는데, 특히 네트워크 연결이 많은 서비스나 많은 파일을 동시에 처리하는 서비스에서는 필수적이다.

#### 🔍 **프로세스별 파일 사용량 모니터링**

lsof -p 명령어를 이용하면 현재 프로세스가 사용중인 파일들의 목록을 볼 수 있어 매우 유용하다. 이는 파일 디스크립터 누수를 찾거나, 어떤 프로세스가 특정 파일을 사용하고 있는지 확인할 때 특히 도움이 된다.

```bash
# 특정 프로세스가 사용하는 파일 확인
lsof -p 12345

# 특정 파일을 사용하는 프로세스 확인  
lsof /var/log/application.log

# 프로세스가 사용하는 파일 개수 확인
lsof -p 12345 | wc -l
```

---

### 📌 크론으로 스케줄링하기

#### ⏰ **크론 설정 시 주의사항**

크론 작업을 설정할 때 가장 중요한 것은 경로 문제다. 웬만하면 파일 경로는 절대경로로 적는게 편하다. 계정마다 시작 위치도 다르고 환경변수도 다르기 때문에 신경써야 할게 많아서 그냥 절대 경로를 추천한다.

```bash
# 크론 편집
crontab -e

# 잘못된 예시 (상대경로)
0 2 * * * ./cleanup.sh

# 올바른 예시 (절대경로)
0 2 * * * /usr/local/bin/cleanup.sh

# 환경변수도 명시적으로 설정
PATH=/usr/local/bin:/usr/bin:/bin
0 2 * * * /usr/local/bin/cleanup.sh
```

---

### 📌 네트워크 상태 확인

#### 🌐 **netstat vs ss 명령어**

네트워크 상태를 확인하는 전통적인 방법은 netstat 명령어였지만, 최근에는 ss 명령어를 더 많이 사용한다. netstat도 좋지만 ss가 커널에서 바로 읽어오는 거라 성능면에서 더 우수하므로 ss를 쓰면 좋다.

```bash
# netstat 방식 (전통적인 방법)
netstat -tulnp

# ss 방식 (권장)
ss -tulnp

# 연결 상태별 통계
ss -s

# 특정 포트 확인
ss -tlnp | grep :8080
```

ss와 netstat의 성능 차이는 연결이 많은 서버에서 확실히 체감할 수 있다. netstat은 /proc/net/ 파일들을 파싱하는 방식이라 연결이 수천 개가 되면 상당히 느려지지만, ss는 커널의 netlink 소켓을 통해 직접 정보를 가져오므로 훨씬 빠르다.

---

#### - **나의 해석 / 생각**:

리눅스 명령어가 정말 종류도 많고 다양한 만큼 다 외우기 보다는 필요할 때 뭐가 있었는지만 알면 좋을 것 같다(AI의 힘을 빌릴수 있다면...)

---

## 💬 3. 이야기하고 싶은 질문 / 포인트

- ❓ 질문 1: 컨테이너 환경에서 사용하기 좋은 명령어들은 무엇이 있을까?

---

## 🎯 4. 정리 & 적용 아이디어

- **내가 배운 것 한 줄 요약**:  
  → `리눅스 서버 운영 시 권한 관리, 안전한 프로세스 종료, 디스크 관리, 스케줄링, 네트워크 모니터링의 기본기를 탄탄히 해야 안정적인 서비스 운영이 가능하다.`
