# 📚 개발 도서 스터디 템플릿

## 🧠 1. 책을 읽기 전에
- **기대하는 점**: 연동이 느려지면 빨리 연결을 끊는 수 밖에 없지 않나..? 뭐가 더 있을까 싶기는 하다.
- **알고 싶은 개념 / 주제**: 트랜잭션 관리를 어떻게 해야할 지.. 등등+

---

## 📂 2. 내용 정리 (자신의 언어로 요약)

### 타임아웃
- 서버에서 연동 서비스를 감당하지 못해 스레드 대기 상태가 이뤄지
- 사용자도 대기시간을 견디지 못해 새로고침으로 새로운 요청을 더 보내게 됨
  - 이건 사용자의 최초 요청 +  새로고침 후 요청이 더해져 서버가 받는 요청이 더 늘어날 수 있음
- 대기보다는 에러를 떨어뜨려 주는게 더 좋다고 본다.
- 연결 타임아웃 : 해외 연결에 대한 네트워크 연결 시간으 당연하게도 더 걸릴 수 밖에 없음
- 그래서 응답을 받기까지의 대기 시간도 발생하는데, 이럴 때 타임아웃을 설정해서 응답 대기 시간을 제한해야 한다.
#### 소켓 타임아웃, 읽기 타임아웃
- 소켓 타임아웃 : 네트워크 패킷 단위를 기준으로 한다. (단, 전체 응답 시간을 의미하지는 않음)
- OkHttp : 읽기 타임아웃과 별개로 호출 타임아웃 설정 가능. 요청 시작부터 응답까지의 전체 시간기준으로 설정
- 소켓 타임아웃 5초, 호출 타임아웃 10초면 패킷은 수신되지만 처리 시간이 오래걸리면 타임아웃 발생 가능

### 재시도
- 재시도 가능 조건 : 연결 타임아웃( 아직 연결된 상태가 아니기 떄문에 다시 재시도 해도 괜찮다.), 단순 조회, 멱등성
- 재시도 시에는 재시도 횟수(2회 이내), 그리고 재시도 간격(을 분석해서 적당한 값을 설정해야 한다.

### 동시 요청 제한, 서킷 브레이커
- 벌크헤드 패턴 : 요청 시에는 일부 요청은 처리, 일부 요청은 에러(503) 으로 되돌릴 수도 있음

#### 서킷 브레이커
서킷 브레이커 : 연동서비스가 장애면 바로 에러를  응답 (일정 임계를 기준으로 판단)
- 닫힘(작동x), 열림(작동O), 반열림(일부 요청에 한해 연동 시도)

### 외부 연동과 DB연동
- 트랜잭션에서 외부 연동에 실패한 경우 롤백
- 외부 연동에서 트랜잭션이 성공했다면
  - 주기적으로 이 값을 맞춰주는 일이 필요(새벽 배치 MSA에서 이런 경우를 활용)
  - 읽기 타임아웃등이 발생했다면, 성공을 확인하는 API를 사용해 정상 처리되었는지 확인
  - 반대로 읽기 타임아웃이 발생했다면, 취소 API를 불러 취소 처리할 수도 있음
  - 이외에도 주기적으로 값이 일치하는지 확인하는 프로세스가 필요(외부API 성공했지만 DB연동에서 실패한 경우)

### DB 커넥션 풀, HTTP 커넥션 풀
- DB커넥션 풀로 문제가 생기면 트랜잭션 커밋 이후 단계에서는 롤백을 해야하기 때문에 주의 필요
- 실패한 외부 연동에 대한 후 처리(보상 트랜잭션)
- HTTP 커넥션 풀의 경우 한번에 너무 많은 요청이 들어오지 않도록 풀의 크기를 제한
- 대기시간을 1-5초 사이로 처리가 필요
- 커넥션도 Keep-Alive 헤더로 연결 유지 시간을 지정할 피룡가 있음

---

## 💬 3. 이야기하고 싶은 질문 / 포인트

💭 더 알아보고 싶은 개념:
- 소켓 타임아웃에 대한 고려 포인트? (예를 들면 카톡 채팅방의 경우 모든 채팅방에 대한 소켓이 열려있는 걸까?)
  - P : 여러 채팅방마다 소켓 연결이 모두 활성화되는 것이 아니라, 사용자-서버 간의 하나의 WebSocket 연결로 모든 채팅방의 실시간 정보를 처리하는 것이 일반적입니다
- @Transactional 사용 기준
  - 단일 DataSource에 대한 연결 필요
  - 연동 서비스에서는 이걸 분리해서 사용하기
---

## 🎯 4. 정리 & 적용 아이디어

- **내가 배운 것 한 줄 요약**:  
  → `이 장을 통해 나는 연동이 많이 되는 서비스에 대한 처리 방식의 변화(재시도 추가 옵셩)를 이해할 수 있었음

---

## 🌟 5. 전체 리뷰

- **별점 평가** (⭐️ 5점 만점): `⭐️⭐️⭐️⭐️`
- **책에 대한 총평**:
- **이 책을 추천한다면 어떤 사람에게?**
